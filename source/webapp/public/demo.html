<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Media2Cloud Solution</title>
    <!-- Required meta tags for bootstrap -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <!-- fontawesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/solid.css" integrity="sha384-+0VIRx+yz1WBcCTXBkVQYIBVNEFH1eP6Zknm16roZCyeNg2maWEpk/l/KsyFKs7G" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/regular.css" integrity="sha384-aubIA90W7NxJ+Ly4QHAqo1JBSwQ0jejV75iHhj59KRwVjLVHjuhS3LkDAoa/ltO4" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/fontawesome.css" integrity="sha384-jLuaxTTBR42U2qJ/pm4JRouHkEDHkVqH0T1nyQXn1mZ7Snycpf6Rl25VBNthU4z0" crossorigin="anonymous">
    <!-- cropper -->
    <link rel="stylesheet" href="./third_party/cropper.min.css" integrity="sha384-%SRI_CROPPER_CSS%">
    <!-- videojs -->
    <link rel="stylesheet" href="./third_party/video-js.min.css" integrity="sha384-%SRI_VIDEOJS_CSS%">
    <link rel="stylesheet" href="./third_party/videojs.markers.min.css" integrity="sha384-%SRI_VIDEOJS_MARKERS_CSS%">
    <!-- app -->
    <link rel="stylesheet" href="./css/app.css" integrity="sha384-%SRI_APP_CSS%">
  </head>

  <body>
    <!-- navigation bar -->
    <nav class="navbar navbar-light bg-dark">
      <a class="navbar-brand">
        <img src="./images/media2cloud-logo.png" width="80%" class="img-fluid" alt="Media2Cloud Solution">
      </a>
      <div class="form-group row">
        <a href="#" id="signoutBtn" class="nav-link collapse" data-toggle="tooltip" data-placement="bottom" title="Click here to sign out">
          <small>Sign out</small>
        </a>
        <a href="#modalSignin" id="signinBtn" class="nav-link" data-toggle="modal" data-target="#modalSignin">
          <small>SIGN IN</small>
        </a>
      </div>
    </nav>
    <!-- /navigation bar -->

    <!-- loading icon -->
    <div
      id="spinning-icon"
      class="spinner-grow text-secondary loading collapse"
      role="status">
      <span class="sr-only">Loading...</span>
    </div>

    <!-- SignIn modal dialog -->
    <div class="modal fade" id="modalSignin" tabindex="-1" role="dialog">
    </div>

    <!-- NewPassword modal dialog -->
    <div class="modal fade" id="modalNewPassword" tabindex="-1" role="dialog">
    </div>

    <!-- ForgotPassword modal dialog -->
    <div class="modal fade" id="modalForgotPassword" tabindex="-1" role="dialog">
    </div>

    <!-- Preview modal dialog -->
    <div class="modal fade" id="video-preview-modal-id" tabindex="-1" role="dialog" data-uuid="${uuid}">
    </div>

    <!-- Image Editor modal dialog -->
    <div class="modal fade" id="image-editor-modal-id" tabindex="-1" role="dialog">
    </div>

    <!-- Label Editor modal dialog -->
    <div class="modal fade" id="label-editor-modal-id" tabindex="-1" role="dialog">
    </div>

    <!-- Image Preview modal dialog -->
    <div class="modal fade" id="image-preview-modal-id" tabindex="-1" role="dialog" data-uuid="${uuid}">
    </div>

    <!-- Image Editor modal for ImagePreview dialog -->
    <div class="modal fade" id="image-editor-modal-id-2" tabindex="-1" role="dialog">
    </div>

    <!-- FileUpload modal dialog -->
    <div class="modal fade" id="file-upload-modal-id" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard=false>
    </div>

    <!-- Media uploader -->
    <div class="modal fade" id="media-upload-modal-id" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard=false>
    </div>

    <!-- Json uploader -->
    <div class="modal fade" id="json-upload-modal-id" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard=false>
    </div>

    <!-- Workteam wizard modal dialog -->
    <div class="modal fade" id="workteam-modal-id" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard=false>
    </div>

    <div class="container mt-4">
      <nav>
        <div class="nav nav-tabs" id="nav-tab" role="tablist">
          <a class="nav-item nav-link active" id="aboutTab" data-toggle="tab" href="#about" role="tab" aria-controls="about" aria-selected="true">About</a>
          <a class="nav-item nav-link" id="architectureTab" data-toggle="tab" href="#architecture" role="tab" aria-controls="architecture" aria-selected="false">Architecture</a>
          <a class="nav-item nav-link" id="demoTab" data-toggle="tab" href="#demo" role="tab" aria-controls="demo" aria-selected="false">Demo</a>
          <a class="nav-item nav-link" id="settingsTab" data-toggle="tab" href="#settings" role="tab" aria-controls="settings" aria-selected="false">Settings</a>
        </div>
      </nav>

      <!-- tab content -->
      <div class="tab-content" id="nav-tabContent">
        <!-- about tab -->
        <div class="tab-pane fade show active mt-4" id="about" role="tabpanel" aria-labelledby="aboutTab">
          <div class="jumbotron mt-4">
            <h1 class="display-5">About the solution</h1>
            <p class="mt-4">Media2Cloud <strong>BETA</strong> is designed to demonstrate a serverless ingest framework that can quickly setup a baseline ingest workflow for placing video assets and associated metadata under management control of an AWS customer.  The solution will setup the core building blocks that are common in a ingest strategy:
              <ul>
                <li>Establish a storage policy that manages master materials as well as proxies generated by the ingest process.</li>
                <li>Provide a unique identifier (UUID) for each master video asset.</li>
                <li>Calculate and provide a MD5 checksum.</li>
                <li>Perform a technical metadata extract against the master video asset.</li>
                <li>Build standardized proxies for use in a media asset management solution.</li>
                <li>Run the proxies through the media analysis solution.</li>
                <li>Provide a serverless dashboard that allows a developer to setup and monitor the ingest process.</li>
              </ul>
            </p>
            <p>Diagram (below) illustrates the functional aspect of Media2Cloud solution</p>
            <div class="pb-4">
              <img src="./images/archive-migration-tear-sheet.png" width="100%" class="img-fluid" alt="Architectural Diagram">
            </div>
            <p>
              Media2Cloud solution uses various AWS managed services included but not limited to the followings:
              <ul>
                <li><i>Amazon Cognito</i> service to manage user signin/signout/access control to the ingest dashboard.</li>
                <li><i>Amazon Glacier</i> and <i>Amazon S3</i> to archive the uploaded assets and to store generated information.</li>
                <li><i>AWS Internet of Things (Iot)</i> to provide async messaging for connected web clients through MQTT pub/sub service.</li>
                <li><i>Amazon Rekognition</i>, <i>Amazon Translate</i>, <i>Amazon Comprehend</i> services to extract AI/ML metadata from the uploaded assets.</li>
                <li><i>Amazon DynamoDB</i> to store asset information.</li>
                <li><i>AWS Step Functions</i> service to manage the ingest and metadata workflows.</li>
                <li><i>Amazon Elasticsearch</i> Service to provide search capability.</li>
                <li><i>AWS Elemental MediaConvert</i> to create streamable proxy of the uploaded asset.</li>
                <li><i>Amazon API Gateway</i> and <i>Amazon SNS</i> services for communications.</li>
                <li><i>AWS Lambda Function</i> to power all serverless logics.</li>
              </ul>
              To understand how each component works, check out <i>Architecture</i> tab.
            </p>
            <p>
              Last but not least, Media2Cloud solution supports the following regions:
              <ul>
                <li>us-east-1 (N. Virginia)</li>
                <li>us-east-2 (Ohio)</li>
                <li>us-west-2 (Oregon)</li>
                <li>eu-west-1 (Ireland)</li>
                <li>ap-southeast-1 (Singapore)</li>
              </ul>
            </p>
            <hr class="mt-4">
            <span class="lead d-flex justify-content-end small">#Team AWS Media & Ententainment</span>
          </div>
        </div>

        <!-- architecture tab -->
        <div class="tab-pane fade" id="architecture" role="tabpanel" aria-labelledby="architectureTab">
          <div class="container mt-4 mb-4 small">
            <div class="pt-4 pb-4">
              <img src="./images/media2cloud-architectural-diagram.svg" width="100%" class="img-fluid" alt="Architectural Diagram">
            </div>
            <div class="card mt-2">
              <div class="card-header">
                Step 1: Authenticate with Amazon Cognito service
              </div>
              <div class="card-body">
                <p>User first needs to authenticate himself with Amazon Cognito User Pool. He/She would then be granted a temporary credential to access certain AWS resources. Note that you could also authenticate against your own AD with Amazon Cognito Federate Identity services through SAML2.0 or OpenID Connect (ODIC).</p>
              </div>
            </div>
            <div class="card mt-2">
                <div class="card-header">
                  Step 2: Subscribe to Amazon IoT
                </div>
                <div class="card-body">
                  <p>The solution uses Amazon IoT Core's message broker to receive asynchronized messages from the backend services. Amazon IoT utilizes MQTT over websocket to keep the client(s) connected. Alternatively, you could also use Amazon SNS or AWS AppSync (GraphQL) service.</p>
                </div>
              </div>
              <div class="card mt-2">
              <div class="card-header">
                Step 3: Query assets through Amazon DynamoDB (from asset table)
              </div>
              <div class="card-body">
                <p>Once the user is signed in, the webapp will scan the asset table and to display the relevant information.</p>
              </div>
            </div>
            <!-- Ingest state machine -->
            <div class="card mt-2">
              <div class="card-header">
                Step 4: Upload a file to Amazon S3 (your Glacier bucket)
              </div>
              <div class="card-body">
                <p>Uploading a file using webapp includes the following steps
                  <ul>
                    <li>Generate a UUID for the asset</li>
                    <li>Calculate MD5 checksum of the entire file</li>
                    <li>Use S3 multipart upload API to upload the file where:</li>
                      <ul>
                        <li>MD5 checksum of the entire file is stored in 'x-amz-metada-md5chk' metadata field</li>
                        <li>Multipart upload also performs MD5 checksum of each part before the part is uploaded</li>
                        <li>Part size is set to 8MB</li>
                      </ul>
                  </ul>
                  The MD5 checksum on the parts ensures the data integrity is intact during uploading to S3 bucket.
                </p>
              </div>
            </div>
            <div class="card mt-2">
              <div class="card-header">
                Step 4': Direct upload to S3 bucket (via AWS console, AWS CLI, or other mechanism)
              </div>
              <div class="card-body">
                <p>The solution supports an use case where you directly upload a file to the S3 bucket without the webapp. There are differences:
                  <ul>
                    <li>'x-amx-metadata-md5chk' metadata field won't be generated. It is up to you to calculate the MD5 checksum and set the metadata field.</li>
                    <li>If 'x-amz-metadata-md5chk' metadata field is missing, the solution assumes '0000'</li>
                    <li>Similarly, UUID will also be set to '0000'</li>
                  </ul>
                </p>
              </div>
            </div>
            <div class="card mt-2">
            <div class="card-header">
              Step 5: S3 Event (s3:OBJECTCREATED)
            </div>
            <div class="card-body">
              <p>Once the file landed on S3, it triggers a lambda function (omitted in the digram) which starts 'ingest state machine' (Amazon Step Functions)</p>
            </div>
            </div>
            <div class="card mt-2">
              <div class="card-header">
                Step 6: Mediainfo state
              </div>
              <div class="card-body">
                <p>In this state, the Lambda Function runs Mediainfo command to gather the technical metadata of the video file. Couple interesting notes:
                  <ul>
                    <li>The lambda function doesn't download the entire video file.</li>
                    <li>Mediainfo fetches just enough data to parse the file.</li>
                    <li>Even if you have 40GB file, it only requires a few KB or MB to parse the video file.</li>
                    <li>The solution also uses signed URL of the S3 object</li>
                  </ul>
                </p>
              </div>
            </div>
            <div class="card mt-2">
              <div class="card-header">
                Step 7: Proxy creation state
              </div>
              <div class="card-body">
                <p>In this state, the Lambda Function prepares a job template and submit a job to AWS Elemental MediaConvert to create a proxy version. If a video file is MXF that contains multiple channels, the lambda function downmixes all channels into stereo so that you don't lose any channel information.</p>
              </div>
            </div>
            <div class="card mt-2">
              <div class="card-header">
                Step 8: AWS Elemental MediaConvert
              </div>
              <div class="card-body">
                <p>MediaConvert takes the source file and transcodes it into 960x540, AVC@1800Kbps MP4 proxy file. It also does frame capture to provide the thumbnail rendered on the webapp.</p>
              </div>
            </div>
            <div class="card mt-2">
              <div class="card-header">
                Step 9: Message dispatch state
              </div>
              <div class="card-body">
                <p>Once the proxy file is generated, the ingest workflow is almost done. The very last state is to send a notification to a SNS topic. Tip: if you have downstream processes that would like to start when our ingest is completed, subscribe to the SNS topic. When you receive notification from us, start your downstream workflows as needed.</p>
              </div>
            </div>
            <div class="card mt-2">
              <div class="card-header">
                Step 10: Register asset to Amazon DynamoDB table
              </div>
              <div class="card-body">
                <p>The solution uses 3 different tables, Configuration, Asset, MediaInfo where
                  <ul>
                    <li>Configuration table stores settings (created dynamically during the CloudFormation Stack creation) that are needed to run the webapp.</li>
                    <li>Asset table stores information of an asset such as MD5, UUID, pointers to proxy, metadata, and etc.</li>
                    <li>Mediainfo table stores technical media data of the asset.</li>
                  </ul>
                </p>
              </div>
            </div>
            <div class="card mt-2">
              <div class="card-header">
                Step 11: Report status to AWS Iot
              </div>
              <div class="card-body">
                <p>Throughout the ingest process, the solution sends messages to Iot message broker. The webapp (connected to Iot) gets notified.</p>
              </div>
            </div>
            <div class="card mt-2">
              <div class="card-header">
                Step 12: Transition to Amazon Glacier
              </div>
              <div class="card-body">
                <p>When the proxy is created, a state lambda function will call putObjectTagging API to set 'IngestCompleted' to true. The Glacier bucket is configured to have a Lifecycle Policy to transition object to Glacier storage based on this 'IngestCompleted' tag.</p>
              </div>
            </div>
            <div class="card mt-2">
              <div class="card-header">
                Step 13 and above are related to metadata state machine.
              </div>
            </div>
            <!-- Metadata state machine -->
            <div class="card mt-2">
              <div class="card-header">
                Step 13: Create metdata via Webapp
              </div>
              <div class="card-body">
                <p>Once the ingest process is completed, the webapp enables a feature to create metadata. Upon request, the webapp sends the request to API Gateway to start the metadata state machine.</p>
              </div>
            </div>
            <div class="card mt-2">
              <div class="card-header">
                Step 14: Amazon API Gateway
              </div>
              <div class="card-body">
                <p>The API Gateway exposes a simple api endpoint (POST method) for starting the state machine. The endpoint is protected by AWS_IAM which means the request is signed with AWS SigV4. For more details, see <a href="https://docs.aws.amazon.com/general/latest/gr/signature-version-4.html">Signature Version 4 Signing Process</a></p>
              </div>
            </div>
            <div class="card mt-2">
              <div class="card-header">
                Step 15: Run media-analysis state machine state
              </div>
              <div class="card-body">
                <p>The Media2Cloud solution was designed to take advantage of the existing, published AWS solution, <a href="https://aws.amazon.com/answers/media-entertainment/media-analysis-solution/">Media Analsysis Solution</a>. Thus, instead of building a different pipeline for AI/ML service, the solution leverages Media Analysis Solution by invoking its analysis state machine. In this state, the solution simply runs the media-analysis-solution state machine and periodically check the exceution status.</p>
              </div>
            </div>
            <div class="card mt-2">
              <div class="card-header">
                Step 16: Media Analysis Solution
              </div>
              <div class="card-body">
                <p>Media Analysis solution workflow</p>
              </div>
            </div>
            <div class="card mt-2">
              <div class="card-header">
                Step 17: Ingesting AI/ML metadata to Amazon Elasticsearch service
              </div>
              <div class="card-body">
                <p>Media Analysis Solution ingests metadata generated by Rekognition, Transcribe, and Comprehend services to Elasticsearch engine. Our solution uses the Elasticsearch engine to provide search capability.</p>
              </div>
            </div>
            <div class="card mt-2">
              <div class="card-header">
                Step 18: Collecting AI/ML results from Media Analysis Solution
              </div>
              <div class="card-body">
                <p>In this state, the media-analysis-state-machine has completed, the solution simply collects all the AI/ML results and prepare the next state.</p>
              </div>
            </div>
            <div class="card mt-2">
              <div class="card-header">
                Step 19: Generate WebVTT tracks
              </div>
              <div class="card-body">
                <p>In this state, the solution generates the subtitle (.vtt) file from the transcription. In addition to that, the solution indeed generates other WebVTT tracks out of the AI/ML metadata such as Labels, Celebrities, Faces. The HTML5 player in this solution simply renders the metadata as if it is webvtt tracks. Each of the clickable buttons under the Preview's carousel view loads a webvtt track.</p>
              </div>
            </div>
            <div class="card mt-2">
              <div class="card-header">
                Step 20: Update AI/ML metadata to Amazon DynamoDB table
              </div>
              <div class="card-body">
                <p>Similar to Step 10.</p>
              </div>
            </div>
            <div class="card mt-2">
              <div class="card-header">
                Step 21: Report status to AWS Iot
              </div>
              <div class="card-body">
                <p>Similar to Step 11.</p>
              </div>
            </div>
            <div class="card mt-2">
              <div class="card-header">
                Step 22: Message dispatch state
              </div>
              <div class="card-body">
                <p>Similar to Step 9</p>
              </div>
            </div>
            <div class="card mt-2">
              <div class="card-header">
                Step 23: Searching asset
              </div>
              <div class="card-body">
                <p>As mentioned earlier, the search capability is provided by Elasticsearch engine. Search any term generated by AI/ML services, Elasticsearch engine will return a list of assets that contain the term.</p>
              </div>
            </div>
          </div>
        </div>

        <!-- demo tab -->
        <div class="tab-pane fade" id="demo" role="tabpanel" aria-labelledby="demoTab">
          <div class="container text-left">
            <!-- search field -->
            <div class="mt-4 row justify-content-end" id="search-container">
            </div>

            <!-- VideoCollection (cards) -->
            <div class="row" id="videoCollectionId">
            </div>

            <!-- load more -->
            <div class="mt-4 mb-4 row">
              <div class="col text-center">
                <button class="btn btn-default" id="idLoadMoreData">Load more...</button>
              </div>
            </div>

          </div>
        </div>

        <!-- settings tab -->
        <div class="tab-pane fade" id="settings" role="tabpanel" aria-labelledby="settingsTab">
        </div>
      </div>
      <!-- /tab content -->

      <!-- debugging -->
      <div class="form-group basic-textarea mt-5 collapse" id="systemMessage">
      </div>
    </div>
    <!-- /main container -->

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.min.js" integrity="sha256-u6BamZiW5tCemje2nrteKC2KoLIKX9lKPSpvCkOhamw=" crossorigin="anonymous"></script>

    <script src="./third_party/mime.min.js" integrity="sha384-%SRI_MIME_JS%"></script> <!-- mime library -->
    <script src="./third_party/cropper.min.js" integrity="sha384-%SRI_CROPPER_JS%"></script> <!-- cropperjs 1.4.3 -->
    <script src="./third_party/video.min.js" integrity="sha384-%SRI_VIDEOJS%"></script> <!-- videojs 7.6.5 -->
    <script src="./third_party/videojs-markers.min.js" integrity="sha384-%SRI_VIDEOJS_MARKERS%"></script> <!-- videojs-markers 0.7.0 -->
    <script src="./third_party/spark-md5.min.js" integrity="sha384-%SRI_SPARK_MD5_JS%"></script> <!-- spark MD5 v3.0.0 -->
    <script src="./third_party/amazon-cognito-identity.min.js" integrity="sha384-%SRI_COGNITO_IDENTITY_JS%"></script>
    <script src="./third_party/aws-iot-sdk-bundle.min.js" integrity="sha384-%SRI_IOT_SDK_JS%"></script>

    <!-- Development --><!--
    <script src="./solution-manifest.js"></script>
    <script src="./dev/common-bundle.js"></script>
    <script src="./dev/mixins/mxZero.js"></script>
    <script src="./dev/mixins/mxReadable.js"></script>
    <script src="./dev/shared/baseWizard.js"></script>
    <script src="./dev/shared/customJsonParser.js"></script>
    <script src="./dev/shared/defaultJsonParser.js"></script>
    <script src="./dev/shared/serviceAvailability.js"></script>
    <script src="./dev/signer.js"></script>
    <script src="./dev/appUtils.js"></script>
    <script src="./dev/apiHelper.js"></script>
    <script src="./dev/storage.js"></script>
    <script src="./dev/myCognito.js"></script>
    <script src="./dev/resetPasswordModal.js"></script>
    <script src="./dev/signInModal.js"></script>
    <script src="./dev/iotSubscriber.js"></script>
    <script src="./dev/baseCard.js"></script>
    <script src="./dev/basePreview.js"></script>
    <script src="./dev/imageCard.js"></script>
    <script src="./dev/videoCard.js"></script>
    <script src="./dev/jsonParser.js"></script>
    <script src="./dev/mediaUploadWizard.js"></script>
    <script src="./dev/jsonUploadWizard.js"></script>
    <script src="./dev/fileUpload.js"></script>
    <script src="./dev/imageEditor.js"></script>
    <script src="./dev/labelEditor.js"></script>
    <script src="./dev/videoPreview.js"></script>
    <script src="./dev/imagePreview.js"></script>
    <script src="./dev/cardFactory.js"></script>
    <script src="./dev/cardCollection.js"></script>
    <script src="./dev/searchBox.js"></script>
    <script src="./dev/systemMessageArea.js"></script>
    <script src="./dev/workteam.js"></script>
    <script src="./dev/settingsTabPanel.js"></script>
    <script src="./dev/googleMap.js"></script>
    <script src="./dev/app.js"></script>
-->

    <!-- Production --><!---->
    <script src="./solution-manifest.js" integrity="sha384-SOLUTION_MANIFEST_SHA384_PLACEHOLDER"></script>
    <script src="./app.min.js" integrity="sha384-%SRI_APP_JS%"></script>
  </body>
</html>
